version: 2

models:
  - name: int_sales
    description: "This intermediate model combines API sales order headers and details, calculates discount metrics, and identifies a customer's first order. It filters for orders with status '5'."

    columns:
      - name: sales_sk
        description: "Surrogate key for sales transaction."
        tests:
          - unique
          - not_null

      - name: sales_order_fk
        description: "Foreign key referring to sales order surrogated."
        tests:
          - not_null

      - name: product_fk
        description: "Foreign key referring to products surrogated."
        tests:
          - not_null

      - name: customer_fk
        description: "Foreign key referring to customers surrogated."
        tests:
          - not_null

      - name: sales_order_detail_id
        description: "Unique identifier for the sales order line item."
        tests:
          - unique
          - not_null

      - name: sales_order_id
        description: "Unique identifier for the sales order header."
        tests:
          - not_null

      - name: product_id
        description: "Identifier for the product."
        tests:
          - not_null

      - name: customer_id
        description: "Identifier for the customer."
        tests:
          - not_null

      - name: sales_person_id
        description: "Identifier for the salesperson."

      - name: territory_id
        description: "Identifier for the sales territory."
        tests:
          - not_null

      - name: order_date
        description: "Date when the order was placed."
        tests:
          - not_null

      - name: due_date
        description: "Date the order is due to the customer."
        tests:
          - not_null
          
      - name: ship_date
        description: "Date the order was shipped to the customer."
        
      - name: order_quantity
        description: "Quantity of the product items in the order detail."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
              
      - name: unit_price
        description: "Unit price of the product."
        tests:
          - not_null

      - name: unit_price_discount_percentage
        description: "Percentage discount applied to the unit price. Null if no discount."

      - name: unit_price_discount_value
        description: "Total discount value applied to this order line item."

      - name: standard_cost
        description: "Standard cost of unit product."
        tests:
          - not_null

      - name: status
        description: "Status of the order (e.g., 5 for completed orders)."
        tests:
          - not_null

      - name: source_updated_at
        description: "Timestamp of the last update of the record in the original data source."
